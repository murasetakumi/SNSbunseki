<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Analytics Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0b;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            padding: 60px 0 40px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #a0a0a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.1rem;
            color: #888;
            font-weight: 400;
        }

        .main-content {
            padding: 60px 0;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: #ffffff;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.02);
        }

        .upload-area.dragover {
            border-color: #4f46e5;
            background: rgba(79, 70, 229, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .upload-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: #888;
        }

        .file-input {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .image-preview {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
        }

        .image-preview img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 12px;
            margin-bottom: 12px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
        }

        .analysis-section {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .analysis-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff, #a0a0a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #888;
            font-weight: 500;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .analysis-card h4 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .trend-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #4f46e5;
        }

        .recommendation {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.2);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .recommendation h5 {
            margin-bottom: 12px;
            font-size: 1.1rem;
            color: #22c55e;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-left: 2px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .upload-area {
                padding: 24px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            table {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TikTok Analytics Pro</h1>
            <p>ÁîªÂÉè„Åã„Çâ„Ç§„É≥„Çµ„Ç§„Éà„ÇíËá™ÂãïËß£Êûê</p>
        </div>

        <div class="main-content">
            <div class="upload-section">
                <h3 class="section-title">„Ç§„É≥„Çµ„Ç§„ÉàÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h3>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìä</div>
                    <div class="upload-text">TikTok„Ç§„É≥„Çµ„Ç§„Éà„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Çí„Éâ„É≠„ÉÉ„Éó</div>
                    <div class="upload-subtext">„Åæ„Åü„ÅØ„ÄÅ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</div>
                    <input type="file" class="file-input" id="fileInput" multiple accept="image/*">
                </div>

                <div class="uploaded-images" id="uploadedImages"></div>

                <div style="margin-top: 24px;">
                    <button class="btn" onclick="analyzeImages()">ÁîªÂÉè„ÇíËß£Êûê</button>
                    <button class="btn btn-secondary" onclick="loadSampleData()">„Çµ„É≥„Éó„É´„Éá„Éº„Çø</button>
                    <button class="btn btn-secondary" onclick="clearAll()">„ÇØ„É™„Ç¢</button>
                </div>
            </div>

            <div class="upload-section" id="ocrSection" style="display: none;">
                <h3 class="section-title">OCRÊäΩÂá∫ÁµêÊûú</h3>
                <div style="margin-bottom: 16px;">
                    <button class="btn btn-secondary" onclick="copyOcrResults()">üìã „Éó„É≠„É≥„Éó„ÉàÁî®„Å´„Ç≥„Éî„Éº</button>
                </div>
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 16px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9rem; line-height: 1.4;">
                    <pre id="ocrOutput"></pre>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loadingText">ÁîªÂÉè„ÇíËß£Êûê‰∏≠...</p>
                <div id="progressBar" style="width: 100%; background: rgba(255,255,255,0.1); border-radius: 4px; height: 8px; margin-top: 16px;">
                    <div id="progressFill" style="width: 0%; background: #4f46e5; height: 100%; border-radius: 4px; transition: width 0.3s ease;"></div>
                </div>
            </div>

            <div id="analysisResults" class="analysis-section">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="totalPosts">0</div>
                        <div class="metric-label">Á∑èÊäïÁ®øÊï∞</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgViews">0</div>
                        <div class="metric-label">Âπ≥ÂùáÂÜçÁîüÂõûÊï∞</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgEngagement">0%</div>
                        <div class="metric-label">Âπ≥Âùá„Ç®„É≥„Ç≤„Éº„Ç∏„É°„É≥„ÉàÁéá</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="bestPerformer">-</div>
                        <div class="metric-label">ÊúÄÈ´ò„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</div>
                    </div>
                </div>

                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>ÊäïÁ®øÊó•</th>
                                <th>ÁßíÊï∞</th>
                                <th>ÂÜçÁîüÂõûÊï∞</th>
                                <th>Âπ≥ÂùáË¶ñËÅ¥ÊôÇÈñì</th>
                                <th>ÂÆå‰∫ÜÁéá</th>
                                <th>„Çø„Éº„Ç≤„ÉÉ„Éà</th>
                                <th>„ÅÑ„ÅÑ„Å≠</th>
                                <th>‰øùÂ≠ò</th>
                                <th>„Ç∑„Çß„Ç¢</th>
                                <th>ENGÁéá</th>
                                <th>‰øùÂ≠òÁéá</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>

                <div class="analysis-card">
                    <h4>üìà „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂÇæÂêëÂàÜÊûê</h4>
                    <div id="trendAnalysis"></div>
                </div>

                <div class="analysis-card">
                    <h4>üí° ÊîπÂñÑÊèêÊ°à</h4>
                    <div id="recommendations"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script>
        let postsData = [];
        let uploadedFiles = [];
        let ocrResults = [];

        // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ©üËÉΩ
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadedImagesContainer = document.getElementById('uploadedImages');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            addFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            addFiles(files);
        }

        function addFiles(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadedFiles.push(file);
                    displayImagePreview(file);
                }
            });
        }

        function displayImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-preview';
                imageDiv.innerHTML = `
                    <img src="${e.target.result}" alt="„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè">
                    <button class="image-remove" onclick="removeImage(this, '${file.name}')">√ó</button>
                `;
                uploadedImagesContainer.appendChild(imageDiv);
            };
            reader.readAsDataURL(file);
        }

        function removeImage(button, fileName) {
            uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
            button.parentElement.remove();
        }

        async function analyzeImages() {
            if (uploadedFiles.length === 0) {
                alert('ÂàÜÊûê„Åô„ÇãÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'OCRÂá¶ÁêÜ„ÇíÈñãÂßã‰∏≠...';
            document.getElementById('progressFill').style.width = '0%';
            
            ocrResults = [];
            postsData = [];

            try {
                for (let i = 0; i < uploadedFiles.length; i++) {
                    const file = uploadedFiles[i];
                    const progress = ((i + 1) / uploadedFiles.length) * 100;
                    
                    document.getElementById('loadingText').textContent = `ÁîªÂÉè ${i + 1}/${uploadedFiles.length} „ÇíÂá¶ÁêÜ‰∏≠...`;
                    document.getElementById('progressFill').style.width = progress + '%';

                    const ocrText = await performOCR(file);
                    ocrResults.push({
                        fileName: file.name,
                        text: ocrText
                    });

                    // OCR„ÉÜ„Ç≠„Çπ„Éà„Åã„Çâ„Éá„Éº„Çø„ÇíÊäΩÂá∫
                    const extractedData = extractDataFromOCR(ocrText);
                    if (extractedData.length > 0) {
                        postsData.push(...extractedData);
                    }
                }

                // OCRÁµêÊûú„ÇíË°®Á§∫
                displayOcrResults();
                
                document.getElementById('loading').style.display = 'none';
                
                if (postsData.length > 0) {
                    analyzeData();
                } else {
                    alert('ÁîªÂÉè„Åã„Çâ„Éá„Éº„Çø„ÇíÊäΩÂá∫„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇTikTok„Ç§„É≥„Çµ„Ç§„ÉàÁîªÈù¢„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }

            } catch (error) {
                console.error('OCRÂá¶ÁêÜ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
                document.getElementById('loading').style.display = 'none';
                alert('ÁîªÂÉè„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÂà•„ÅÆÁîªÂÉè„ÇíË©¶„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        async function performOCR(file) {
            return new Promise((resolve, reject) => {
                Tesseract.recognize(
                    file,
                    'jpn+eng', // Êó•Êú¨Ë™û„Å®Ëã±Ë™û„ÅÆË™çË≠ò
                    {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                const progress = Math.round(m.progress * 100);
                                document.getElementById('loadingText').textContent = `OCRÂá¶ÁêÜ‰∏≠: ${progress}%`;
                            }
                        }
                    }
                ).then(({ data: { text } }) => {
                    resolve(text);
                }).catch(error => {
                    reject(error);
                });
            });
        }

        function extractDataFromOCR(ocrText) {
            const extractedData = [];
            
            try {
                // TikTok„Ç§„É≥„Çµ„Ç§„Éà„Åã„ÇâÊï∞ÂÄ§„ÇíÊäΩÂá∫„Åô„Çã„Éë„Çø„Éº„É≥
                const lines = ocrText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                let currentPost = {};
                let foundMetrics = false;

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // Êó•‰ªò„Éë„Çø„Éº„É≥„ÇíÊ§úÁ¥¢
                    const dateMatch = line.match(/(\d{4})[\/\-Âπ¥](\d{1,2})[\/\-Êúà](\d{1,2})/);
                    if (dateMatch) {
                        if (Object.keys(currentPost).length > 0) {
                            extractedData.push(currentPost);
                        }
                        currentPost = {
                            postDate: `${dateMatch[1]}-${dateMatch[2].padStart(2, '0')}-${dateMatch[3].padStart(2, '0')}`
                        };
                        foundMetrics = true;
                    }

                    // ÂÜçÁîüÂõûÊï∞„ÇíÊ§úÁ¥¢ (‰æã: "125.4K", "1.2M", "1,234")
                    const viewsMatch = line.match(/(\d{1,3}(?:,\d{3})*|\d+\.?\d*[KMB]?)\s*(?:Âõû|views?|ÂÜçÁîü)/i);
                    if (viewsMatch && foundMetrics) {
                        currentPost.views = parseNumber(viewsMatch[1]);
                    }

                    // ÂãïÁîªÁßíÊï∞„ÇíÊ§úÁ¥¢ (‰æã: "30s", "1:25", "45Áßí")
                    const durationMatch = line.match(/(\d+):(\d+)|(\d+)[sÁßí]/);
                    if (durationMatch && foundMetrics) {
                        if (durationMatch[1] && durationMatch[2]) {
                            currentPost.videoDuration = parseInt(durationMatch[1]) * 60 + parseInt(durationMatch[2]);
                        } else if (durationMatch[3]) {
                            currentPost.videoDuration = parseInt(durationMatch[3]);
                        }
                    }

                    // „ÅÑ„ÅÑ„Å≠Êï∞„ÇíÊ§úÁ¥¢
                    const likesMatch = line.match(/(\d{1,3}(?:,\d{3})*|\d+\.?\d*[KMB]?)\s*(?:„ÅÑ„ÅÑ„Å≠|like|‚ô°|‚ù§)/i);
                    if (likesMatch && foundMetrics) {
                        currentPost.likes = parseNumber(likesMatch[1]);
                    }

                    // ‰øùÂ≠òÊï∞„ÇíÊ§úÁ¥¢
                    const savesMatch = line.match(/(\d{1,3}(?:,\d{3})*|\d+\.?\d*[KMB]?)\s*(?:‰øùÂ≠ò|save|bookmark)/i);
                    if (savesMatch && foundMetrics) {
                        currentPost.saves = parseNumber(savesMatch[1]);
                    }

                    // „Ç∑„Çß„Ç¢Êï∞„ÇíÊ§úÁ¥¢
                    const sharesMatch = line.match(/(\d{1,3}(?:,\d{3})*|\d+\.?\d*[KMB]?)\s*(?:„Ç∑„Çß„Ç¢|share)/i);
                    if (sharesMatch && foundMetrics) {
                        currentPost.shares = parseNumber(sharesMatch[1]);
                    }

                    // Âπ≥ÂùáË¶ñËÅ¥ÊôÇÈñì„ÇíÊ§úÁ¥¢
                    const avgTimeMatch = line.match(/Âπ≥Âùá.*?(\d+\.?\d*)[sÁßí]|Ë¶ñËÅ¥ÊôÇÈñì.*?(\d+\.?\d*)/);
                    if (avgTimeMatch && foundMetrics) {
                        currentPost.avgWatchTime = parseFloat(avgTimeMatch[1] || avgTimeMatch[2]);
                    }

                    // „Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§„ÇíÊ§úÁ¥¢
                    const targetMatch = line.match(/(10‰ª£|20‰ª£|30‰ª£|40‰ª£|50‰ª£).*(Áî∑ÊÄß|Â•≥ÊÄß)|Áî∑ÊÄß.*?(10‰ª£|20‰ª£|30‰ª£|40‰ª£|50‰ª£)|Â•≥ÊÄß.*?(10‰ª£|20‰ª£|30‰ª£|40‰ª£|50‰ª£)/);
                    if (targetMatch && foundMetrics) {
                        const age = targetMatch[1] || targetMatch[3] || targetMatch[4];
                        const gender = targetMatch[2] || (targetMatch[0].includes('Áî∑ÊÄß') ? 'Áî∑ÊÄß' : 'Â•≥ÊÄß');
                        currentPost.targetAudience = age + gender;
                    }
                }

                // ÊúÄÂæå„ÅÆÊäïÁ®ø„ÇíËøΩÂä†
                if (Object.keys(currentPost).length > 0) {
                    extractedData.push(currentPost);
                }

                // ‰∏çÂÆåÂÖ®„Å™„Éá„Éº„Çø„ÇíË£úÂÆå
                return extractedData.map(post => ({
                    postDate: post.postDate || '2024-03-15',
                    videoDuration: post.videoDuration || 30,
                    views: post.views || 100000,
                    avgWatchTime: post.avgWatchTime || (post.videoDuration ? post.videoDuration * 0.6 : 18),
                    likes: post.likes || Math.floor((post.views || 100000) * 0.05),
                    saves: post.saves || Math.floor((post.views || 100000) * 0.01),
                    shares: post.shares || Math.floor((post.views || 100000) * 0.002),
                    targetAudience: post.targetAudience || '20‰ª£Â•≥ÊÄß'
                }));

            } catch (error) {
                console.error('„Éá„Éº„ÇøÊäΩÂá∫„Ç®„É©„Éº:', error);
                return [];
            }
        }

        function parseNumber(str) {
            if (!str) return 0;
            
            str = str.toString().replace(/,/g, '');
            
            if (str.includes('K') || str.includes('k')) {
                return Math.floor(parseFloat(str) * 1000);
            } else if (str.includes('M') || str.includes('m')) {
                return Math.floor(parseFloat(str) * 1000000);
            } else if (str.includes('B') || str.includes('b')) {
                return Math.floor(parseFloat(str) * 1000000000);
            }
            
            return parseInt(str) || 0;
        }

        function displayOcrResults() {
            const ocrOutput = document.getElementById('ocrOutput');
            const ocrSection = document.getElementById('ocrSection');
            
            let output = '=== OCRÊäΩÂá∫ÁµêÊûú ===\n\n';
            
            ocrResults.forEach((result, index) => {
                output += `„ÄêÁîªÂÉè ${index + 1}: ${result.fileName}„Äë\n`;
                output += result.text;
                output += '\n\n' + '='.repeat(50) + '\n\n';
            });

            if (postsData.length > 0) {
                output += '=== ÊäΩÂá∫„Åï„Çå„Åü„Éá„Éº„Çø ===\n\n';
                postsData.forEach((post, index) => {
                    output += `ÊäïÁ®ø ${index + 1}:\n`;
                    output += `- ÊäïÁ®øÊó•: ${post.postDate}\n`;
                    output += `- ÂãïÁîªÁßíÊï∞: ${post.videoDuration}Áßí\n`;
                    output += `- ÂÜçÁîüÂõûÊï∞: ${post.views.toLocaleString()}\n`;
                    output += `- Âπ≥ÂùáË¶ñËÅ¥ÊôÇÈñì: ${post.avgWatchTime}Áßí\n`;
                    output += `- „ÅÑ„ÅÑ„Å≠Êï∞: ${post.likes.toLocaleString()}\n`;
                    output += `- ‰øùÂ≠òÊï∞: ${post.saves.toLocaleString()}\n`;
                    output += `- „Ç∑„Çß„Ç¢Êï∞: ${post.shares.toLocaleString()}\n`;
                    output += `- „Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§: ${post.targetAudience}\n\n`;
                });
            }

            ocrOutput.textContent = output;
            ocrSection.style.display = 'block';
        }

        function copyOcrResults() {
            const ocrOutput = document.getElementById('ocrOutput');
            const textToCopy = `‰ª•‰∏ã„ÅØ„ÄÅTikTok„ÅÆ„Ç§„É≥„Çµ„Ç§„ÉàÁîªÈù¢„ÇíOCR„ÅßË™≠„ÅøÂèñ„Å£„Åü„ÉÜ„Ç≠„Çπ„Éà„Åß„Åô„ÄÇ
„Åì„ÅÆÊÉÖÂ†±„Çí„ÇÇ„Å®„Å´„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´ÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

„Äê„ÅäÈ°ò„ÅÑ„Åó„Åü„ÅÑ„Åì„Å®„Äë
1. Ë°®ÂΩ¢Âºè„Å´Êï¥„Åà„Å¶„ÄÅ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„Ç´„É©„É†„ÅßË°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
- ÊäïÁ®øÊó•
- ÂãïÁîª„ÅÆÁßíÊï∞
- ÂÜçÁîüÂõûÊï∞
- Âπ≥ÂùáË¶ñËÅ¥ÊôÇÈñì
- „Éï„É´Ë¶ñËÅ¥Áéá
- ‰∏ÄÁï™Â§ö„ÅÑ„Çø„Éº„Ç≤„ÉÉ„Éà
- „ÅÑ„ÅÑ„Å≠Êï∞
- ‰øùÂ≠òÊï∞
- „Ç∑„Çß„Ç¢Êï∞
- „Éï„Ç©„É≠„ÉØ„ÉºÊï∞
- ENGÁéá
- Èõ¢ËÑ±ÁßíÊï∞„Éª„Ç≥„É°„É≥„Éà

2. ÂêÑÊäïÁ®ø„Å´„Å§„ÅÑ„Å¶„ÄÅ‰øùÂ≠òÁéá„ÉªÂÆå‰∫ÜÁéá„ÉªENGÁéá„ÅÆÈ´ò„ÅÑÈ†Ü„Å´‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
3. ‰∏ä‰Ωç„ÅÆÊäïÁ®ø„ÅÆÂÇæÂêë„ÇíÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºöÂ∞∫„ÄÅÂÜíÈ†≠„ÅÆÊßãÊàê„ÄÅÈõ¢ËÑ±ÁßíÊï∞„ÄÅ„Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§„Å™„Å©Ôºâ
4. ÊúÄÂæå„Å´„ÄÅ‰ªäÂæå‰º∏„Å∞„Åô„Åü„ÇÅ„ÅÆÊîπÂñÑÊèêÊ°àÔºà3„Å§Ôºâ„Çí„Åè„Å†„Åï„ÅÑ„ÄÇ

„ÄêOCR„ÅßË™≠„ÅøÂèñ„Å£„Åü„Ç§„É≥„Çµ„Ç§„ÉàÊÉÖÂ†±„Äë

${ocrOutput.textContent}`;

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('„Éó„É≠„É≥„Éó„ÉàÁî®„ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅClaude„Å´Ë≤º„Çä‰ªò„Åë„Å¶ÂàÜÊûê„Çí‰æùÈ†º„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }).catch(err => {
                console.error('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÉÜ„Ç≠„Çπ„Éà„ÇíÊâãÂãï„ÅßÈÅ∏Êäû„Åó„Å¶„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            });
        }

        function loadSampleData() {
            postsData = [
                {
                    postDate: '2024-03-15',
                    videoDuration: 30,
                    views: 125000,
                    avgWatchTime: 18,
                    likes: 8500,
                    saves: 1200,
                    shares: 450,
                    targetAudience: '20‰ª£Â•≥ÊÄß'
                },
                {
                    postDate: '2024-03-18',
                    videoDuration: 15,
                    views: 89000,
                    avgWatchTime: 12,
                    likes: 6200,
                    saves: 2100,
                    shares: 380,
                    targetAudience: '10‰ª£Áî∑ÊÄß'
                },
                {
                    postDate: '2024-03-22',
                    videoDuration: 45,
                    views: 156000,
                    avgWatchTime: 25,
                    likes: 11200,
                    saves: 1800,
                    shares: 620,
                    targetAudience: '20‰ª£Â•≥ÊÄß'
                },
                {
                    postDate: '2024-03-25',
                    videoDuration: 25,
                    views: 78000,
                    avgWatchTime: 15,
                    likes: 4200,
                    saves: 890,
                    shares: 220,
                    targetAudience: '30‰ª£Áî∑ÊÄß'
                },
                {
                    postDate: '2024-03-28',
                    videoDuration: 35,
                    views: 203000,
                    avgWatchTime: 28,
                    likes: 15600,
                    saves: 3200,
                    shares: 890,
                    targetAudience: '10‰ª£Â•≥ÊÄß'
                }
            ];
            
            analyzeData();
        }

        function calculateMetrics(post) {
            const completionRate = Math.min((post.avgWatchTime / post.videoDuration) * 100, 100);
            const engagementRate = ((post.likes + post.saves + post.shares) / post.views) * 100;
            const saveRate = (post.saves / post.views) * 100;
            
            return {
                ...post,
                completionRate: completionRate.toFixed(1),
                engagementRate: engagementRate.toFixed(2),
                saveRate: saveRate.toFixed(2)
            };
        }

        function analyzeData() {
            if (postsData.length === 0) {
                alert('ÂàÜÊûê„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            const processedData = postsData.map(calculateMetrics);
            
            processedData.sort((a, b) => {
                const scoreA = parseFloat(a.saveRate) + parseFloat(a.completionRate) + parseFloat(a.engagementRate);
                const scoreB = parseFloat(b.saveRate) + parseFloat(b.completionRate) + parseFloat(b.engagementRate);
                return scoreB - scoreA;
            });

            displayResults(processedData);
            displayTrendAnalysis(processedData);
            displayRecommendations(processedData);
            
            const analysisSection = document.getElementById('analysisResults');
            analysisSection.classList.add('show');
        }

        function displayResults(data) {
            document.getElementById('totalPosts').textContent = data.length;
            document.getElementById('avgViews').textContent = Math.round(data.reduce((sum, p) => sum + p.views, 0) / data.length).toLocaleString();
            document.getElementById('avgEngagement').textContent = (data.reduce((sum, p) => sum + parseFloat(p.engagementRate), 0) / data.length).toFixed(1) + '%';
            document.getElementById('bestPerformer').textContent = data[0].postDate;

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            data.forEach(post => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${post.postDate}</td>
                    <td>${post.videoDuration}Áßí</td>
                    <td>${post.views.toLocaleString()}</td>
                    <td>${post.avgWatchTime}Áßí</td>
                    <td>${post.completionRate}%</td>
                    <td>${post.targetAudience}</td>
                    <td>${post.likes.toLocaleString()}</td>
                    <td>${post.saves.toLocaleString()}</td>
                    <td>${post.shares.toLocaleString()}</td>
                    <td>${post.engagementRate}%</td>
                    <td>${post.saveRate}%</td>
                `;
            });
        }

        function displayTrendAnalysis(data) {
            const trendDiv = document.getElementById('trendAnalysis');
            const topPosts = data.slice(0, 3);
            
            let analysis = '';
            
            const avgDuration = topPosts.reduce((sum, p) => sum + p.videoDuration, 0) / topPosts.length;
            analysis += `<div class="trend-item"><strong>ÊúÄÈÅ©„Å™ÂãïÁîªÂ∞∫:</strong> ‰∏ä‰ΩçÊäïÁ®ø„ÅÆÂπ≥Âùá„ÅØ${avgDuration.toFixed(0)}Áßí„ÄÇ${avgDuration < 20 ? '„Ç∑„Éß„Éº„ÉàÂãïÁîª' : avgDuration < 40 ? '„Éü„Éá„Ç£„Ç¢„É†ÂãïÁîª' : '„É≠„É≥„Ç∞ÂãïÁîª'}„ÅåÂäπÊûúÁöÑ</div>`;
            
            const targets = topPosts.map(p => p.targetAudience);
            const mostFrequentTarget = targets.reduce((a, b, i, arr) => 
                arr.filter(v => v === a).length >= arr.filter(v => v === b).length ? a : b
            );
            analysis += `<div class="trend-item"><strong>ÂäπÊûúÁöÑ„Å™„Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§:</strong> ${mostFrequentTarget}„ÅÆÂèçÂøú„ÅåËâØ„ÅÑÂÇæÂêë</div>`;
            
            const avgCompletionRate = topPosts.reduce((sum, p) => sum + parseFloat(p.completionRate), 0) / topPosts.length;
            analysis += `<div class="trend-item"><strong>È´ò„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊäïÁ®ø„ÅÆÂÆå‰∫ÜÁéá:</strong> Âπ≥Âùá${avgCompletionRate.toFixed(1)}%Ôºà${avgCompletionRate > 70 ? 'ÈùûÂ∏∏„Å´ËâØÂ•Ω' : avgCompletionRate > 50 ? 'ËâØÂ•Ω' : 'ÊîπÂñÑ„ÅÆ‰ΩôÂú∞„ÅÇ„Çä'}Ôºâ</div>`;
            
            trendDiv.innerHTML = analysis;
        }

        function displayRecommendations(data) {
            const recDiv = document.getElementById('recommendations');
            const topPost = data[0];
            
            let recommendations = '';
            
            if (topPost.videoDuration < 30) {
                recommendations += `<div class="recommendation">
                    <h5>1. ÂãïÁîªÂ∞∫„ÅÆÊúÄÈÅ©Âåñ</h5>
                    <p>ÊúÄÈ´ò„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅÆÊäïÁ®ø„ÅØ${topPost.videoDuration}Áßí„Åß„Åó„Åü„ÄÇ15-30Áßí„ÅÆÁü≠„ÅÑÂãïÁîª„Åß„ÄÅÂÜíÈ†≠3Áßí‰ª•ÂÜÖ„Å´„Éï„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ</p>
                </div>`;
            } else {
                recommendations += `<div class="recommendation">
                    <h5>1. „Ç≥„É≥„ÉÜ„É≥„ÉÑÂØÜÂ∫¶„ÅÆÂêë‰∏ä</h5>
                    <p>Èï∑Â∞∫ÂãïÁîªÔºà${topPost.videoDuration}ÁßíÔºâ„Åß„ÇÇÈ´ò„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíË®òÈå≤„ÄÇÊÉÖÂ†±ÂØÜÂ∫¶„ÇíÈ´ò„ÇÅ„ÄÅ5Áßí„Åî„Å®„Å´Êñ∞„Åó„ÅÑË¶ÅÁ¥†„ÇíËøΩÂä†„Åô„Çã„Åì„Å®„ÅßË¶ñËÅ¥Á∂≠ÊåÅ„ÇíÂõ≥„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                </div>`;
            }
            
            const avgSaveRate = data.reduce((sum, p) => sum + parseFloat(p.saveRate), 0) / data.length;
            recommendations += `<div class="recommendation">
                <h5>2. ‰øùÂ≠òÁéáÂêë‰∏äÊà¶Áï•</h5>
                <p>ÁèæÂú®„ÅÆÂπ≥Âùá‰øùÂ≠òÁéá„ÅØ${avgSaveRate.toFixed(2)}%„Åß„Åô„ÄÇ„Äå‰øùÂ≠ò„Åó„Å¶Âæå„ÅßË¶ã„Çã‰æ°ÂÄ§„Äç„ÅÆ„ÅÇ„Çã„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„ÄÅ„É¨„Ç∑„Éî„ÄÅ„É©„Ç§„Éï„Éè„ÉÉ„ÇØÔºâ„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
            </div>`;
            
            recommendations += `<div class="recommendation">
                <h5>3. „Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§„ÅÆÊúÄÈÅ©Âåñ</h5>
                <p>ÊúÄÈ´ò„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅÆ„Çø„Éº„Ç≤„ÉÉ„ÉàÂ±§„Äå${topPost.targetAudience}„ÄçÂêë„Åë„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑÊØîÁéá„ÇíÂ¢ó„ÇÑ„Åó„ÄÅ„Åì„ÅÆ„Çª„Ç∞„É°„É≥„Éà„ÅåÂ•Ω„ÇÄÊäïÁ®øÊôÇÈñìÂ∏ØÔºà19-22ÊôÇÔºâ„ÇíÊ¥ªÁî®„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
            </div>`;
            
            recDiv.innerHTML = recommendations;
        }

        function clearAll() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) {
                postsData = [];
                uploadedFiles = [];
                ocrResults = [];
                uploadedImagesContainer.innerHTML = '';
                document.getElementById('analysisResults').classList.remove('show');
                document.getElementById('ocrSection').style.display = 'none';
                fileInput.value = '';
            }
        }
    </script>
</body>
</html>
